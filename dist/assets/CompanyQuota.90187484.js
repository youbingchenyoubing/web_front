import{bh as T,cn as j,bi as N,_ as z,r as w,o as i,a8 as d,w as n,aB as k,aC as X,f as l,d as b,aA as I,F as D,h as f,E as J,b as G,c as A,bE as B,cw as Z,ab as S,U as R,e as E,ac as $,bD as F,c8 as ee,p as te,i as oe}from"./index.41bf9c1b.js";import{E as le}from"./el-pagination.1e9489f1.js";import{E as ne,a as ae}from"./el-table-column.4b985531.js";import{E as L,a as K}from"./el-select.1fc6c445.js";import"./el-popper.7ae0c7d7.js";import{E as se}from"./el-link.e79f8a31.js";/* empty css                       *//* empty css                   */import{h as P}from"./moment.40bc58bf.js";import{f as q}from"./formatDate.66ef0a13.js";import"./el-collapse-transition.bb7c8a08.js";import{E as Q}from"./el-date-picker.79f6dda8.js";import{u as O,b as re}from"./EnumGlobalStore.f9b8c63d.js";import{E as ie}from"./index.aa5a1392.js";import{E as W,a as H}from"./index.39967f43.js";import{E as me}from"./el-dialog.db387371.js";import{E as ue}from"./index.6f6ffc3e.js";import"./isEqual.f69c734a.js";import"./debounce.917afbd5.js";import"./index.01c8af0b.js";import"./strings.2f51a18b.js";import"./castArray.422477ef.js";import"./index.56404ca9.js";import"./index.5d666713.js";import"./refs.90407178.js";const de=e=>T({url:"/company/energy/config/page",loading:!0,data:e}),M=e=>T({url:"/company/energy/config/delete/"+e.id,loading:!0}),ce=e=>T({url:"/company/energy/config/get/"+e.id,loading:!0}),pe=e=>j({url:"/company/energy/config/add",loading:!0,data:e}),ye=e=>j({url:"/company/energy/config/update",loading:!0,data:e}),fe=e=>T({url:"/company/page",loading:!0,data:e});const he={props:["show"],emits:["onSearch"],data(){return{form:{shortName:"",industry:"",type:"",area:""},system_global_status:[],industrys:[],energy_type:[]}},methods:{...N(O,["resolveDictItemEnum"]),async init(){const e=await this.resolveDictItemEnum(["industrys"]);Object.assign(this,e)},async getEnergyType(){const e=await this.resolveDictItemEnum(["energy_type"]);Object.assign(this,e)},handleReset(){this.$emit("onSearch",{}),this.$refs.formRef.resetFields()},handleSearch(){const e=Object.entries(this.form).reduce((t,[a,c])=>(c!==""&&(t[a]=c),t),{});this.$emit("onSearch",e)}},created(){this.init(),this.getEnergyType()}};function _e(e,t,a,c,o,s){const x=J,y=W,h=L,_=K,v=Q,V=w("Search"),p=G,g=A,r=w("Refresh"),U=H,Y=ie;return i(),d(Y,null,{default:n(()=>[k(l(U,{class:"sys-filters",ref:"formRef",inline:"",model:o.form},{default:n(()=>[l(y,{label:"\u4F01\u4E1A\u7B80\u79F0",prop:"shortName"},{default:n(()=>[l(x,{placeholder:"\u8BF7\u8F93\u5165\u4F01\u4E1A\u7B80\u79F0",clearable:"",modelValue:o.form.shortName,"onUpdate:modelValue":t[0]||(t[0]=m=>o.form.shortName=m)},null,8,["modelValue"])]),_:1}),l(y,{label:"\u6240\u5C5E\u884C\u4E1A",prop:"industry"},{default:n(()=>[l(_,{modelValue:o.form.industry,"onUpdate:modelValue":t[1]||(t[1]=m=>o.form.industry=m),clearable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:n(()=>[(i(!0),b(D,null,I(o.industrys,m=>(i(),d(h,{key:m.v,label:m.k,value:m.v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"\u80FD\u8017\u9879\u76EE",prop:"type"},{default:n(()=>[l(_,{modelValue:o.form.type,"onUpdate:modelValue":t[2]||(t[2]=m=>o.form.type=m),clearable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:n(()=>[(i(!0),b(D,null,I(o.energy_type,m=>(i(),d(h,{key:m.v,label:m.k,value:m.v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"\u5E74\u5EA6",prop:"year"},{default:n(()=>[l(v,{modelValue:o.form.year,"onUpdate:modelValue":t[3]||(t[3]=m=>o.form.year=m),clearable:"",type:"year",placeholder:"\u9009\u62E9\u5E74"},null,8,["modelValue"])]),_:1}),l(y,null,{default:n(()=>[l(g,{type:"primary",onClick:s.handleSearch},{default:n(()=>[l(p,null,{default:n(()=>[l(V)]),_:1}),f(" \u67E5\u8BE2 ")]),_:1},8,["onClick"]),l(g,{onClick:s.handleReset},{default:n(()=>[l(p,null,{default:n(()=>[l(r)]),_:1}),f(" \u91CD\u7F6E ")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),[[X,a.show]])]),_:1})}const ge=z(he,[["render",_e],["__scopeId","data-v-137a534b"]]);const be={props:["modelValue","type","ids"],emits:["update:modelValue","onSubmit"],data(){return{form:{amount:"",companyId:"",createName:"",industry:"",month:null,remark:"",shortName:"",type:"",unit:"",year:null},system_global_status:[],rules:{year:[{required:!0,message:"\u8BF7\u9009\u62E9\u5E74\u5EA6",trigger:"change"}],companyId:[{required:!0,message:"\u8BF7\u9009\u62E9\u4F01\u4E1A",trigger:"change"}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u80FD\u8017\u7C7B\u578B",trigger:"change"}]},energy_type:[],company:[]}},computed:{show:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},title(){return this.type===4?"\u914D\u989D\u8BE6\u60C5":this.type===1?"\u65B0\u589E\u914D\u989D":"\u4FEE\u6539\u914D\u989D"}},mounted(){this.initCompany(),this.getEnergyType()},methods:{...N(O,["resolveDictItemEnum"]),async initCompany(){const{records:e}=await fe({current:0,size:200});var t=e.filter(a=>a.isQuota==1);t&&(this.company=t.map(a=>({value:a.id,label:a.shortName})))},async getEnergyType(){},async init(){if([2,4].indexOf(this.type)>-1){const e=await ce({id:this.ids[0]});Object.assign(this.form,{...e,year:`${e.year}`})}},async invokeCreate(){var e=JSON.parse(JSON.stringify(this.form));if(this.form.year){var t=P(this.form.year).format("YYYY");e.year=t}this.form.companyId&&(e.shortName=this.company.find(a=>a.value==this.form.companyId).label),delete e.id,delete e.createTime,delete e.createBy,delete e.updateTime,delete e.updateBy,await pe(e),B.success("\u521B\u5EFA\u4F01\u4E1A\u80FD\u8017\u914D\u989D\u6210\u529F")},async invokeUpdate(e){var t=JSON.parse(JSON.stringify(this.form));if(this.form.year){var a=P(this.form.year).format("YYYY");t.year=a}this.form.companyId&&(t.shortName=this.company.find(c=>c.value==this.form.companyId).label),t.id=e,delete t.createTime,delete t.createBy,delete t.updateTime,delete t.updateBy,await ye(t),B.success("\u4FEE\u6539\u4F01\u4E1A\u80FD\u8017\u914D\u989D\u6210\u529F")},async onSubmit(){try{const{formRef:t}=this.$refs;await t.validate()}catch{return}const{type:e}=this;if(e===1)await this.invokeCreate();else if(e===2)await this.invokeUpdate(this.ids[0]);else if(e===3)await Promise.all(this.ids.map(this.invokeUpdate));else return console.error("SystemPost->EditorDialog->onSubmit: \u672A\u77E5\u7684\u64CD\u4F5C\u7C7B\u578B "+e);this.onCancel(),this.$emit("onSubmit")},onCancel(){const{formRef:e}=this.$refs;this.show=!1,e.resetFields()},chooseType(e){e=="\u7535"?this.form.unit="\u4E07\u5343\u74E6\u65F6":e=="\u7164"?this.form.unit="\u4E07\u5428":e=="\u6CB9"?this.form.unit="\u4E07\u5428":e=="\u6C14"?this.form.unit="\u4E07\u7ACB\u65B9\u7C73":e=="\u6C34"?this.form.unit="\u4E07\u5428":e=="\u6C34\u84B8\u6C14"?this.form.unit="\u767E\u4E07\u5343\u7126":this.form.unit="\u4E07\u5428"},formatInputNumber:Z},watch:{show:{immediate:!0,handler(e){e&&this.init()}}}},ve={key:1,class:"select"},ke={key:1,class:"select"},Ee={key:1,class:"select"},Ve={class:"dialog-footer"};function we(e,t,a,c,o,s){const x=Q,y=W,h=L,_=K,v=J,V=H,p=A,g=me;return i(),d(g,{modelValue:s.show,"onUpdate:modelValue":t[6]||(t[6]=r=>s.show=r),title:s.title,width:"762px","append-to-body":!0,"destroy-on-close":!0,"before-close":s.onCancel},{default:n(()=>[l(V,{ref:"formRef",model:o.form,inline:!0,rules:a.type===4?"":o.rules,"label-width":"100px",class:"form"},{default:n(()=>[l(y,{label:"\u5E74\u5EA6\uFF1A",prop:"year"},{default:n(()=>[a.type!=4?(i(),d(x,{key:0,modelValue:o.form.year,"onUpdate:modelValue":t[0]||(t[0]=r=>o.form.year=r),type:"year",placeholder:"\u9009\u62E9\u5E74"},null,8,["modelValue"])):(i(),b("div",ve,S(o.form.year),1))]),_:1}),l(y,{label:"\u9009\u62E9\u4F01\u4E1A\uFF1A",prop:"companyId"},{default:n(()=>[a.type!=4?(i(),d(_,{key:0,modelValue:o.form.companyId,"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.companyId=r),placeholder:"\u8BF7\u9009\u62E9"},{default:n(()=>[(i(!0),b(D,null,I(o.company,r=>(i(),d(h,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(i(),b("div",ke,S(o.form.shortName),1))]),_:1}),l(y,{label:"\u80FD\u8017\u7C7B\u578B\uFF1A",prop:"type"},{default:n(()=>[a.type!=4?(i(),d(_,{key:0,modelValue:o.form.type,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.type=r),onChange:s.chooseType,placeholder:"\u8BF7\u9009\u62E9"},{default:n(()=>[(i(!0),b(D,null,I(o.energy_type,r=>(i(),d(h,{key:r.v,label:r.k,value:r.v},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])):(i(),b("div",Ee,S(o.form.type),1))]),_:1}),l(y,{label:"\u80FD\u6E90\u914D\u989D\uFF1A",prop:"amount"},{default:n(()=>[l(v,{class:R(["input",a.type===4?"detail":""]),modelValue:o.form.amount,"onUpdate:modelValue":t[3]||(t[3]=r=>o.form.amount=r),placeholder:a.type===4?"":"\u8BF7\u8F93\u5165\u80FD\u6E90\u914D\u989D"},null,8,["class","modelValue","placeholder"])]),_:1}),l(y,{label:"\u80FD\u6E90\u5355\u4F4D\uFF1A",prop:"unit"},{default:n(()=>[l(v,{class:R(["input",a.type===4?"detail":""]),modelValue:o.form.unit,"onUpdate:modelValue":t[4]||(t[4]=r=>o.form.unit=r),disabled:"true",placeholder:a.type===4?"":"\u8BF7\u8F93\u5165\u80FD\u6E90\u5355\u4F4D"},null,8,["class","modelValue","placeholder"])]),_:1}),l(y,{label:"\u5907\u6CE8\uFF1A",prop:"remark"},{default:n(()=>[l(v,{modelValue:o.form.remark,"onUpdate:modelValue":t[5]||(t[5]=r=>o.form.remark=r),type:"textarea",placeholder:a.type===4?"":"\u8BF7\u8F93\u5165\u5907\u6CE8",maxlength:200,"show-word-limit":"",class:R([a.type===4?"detail":"","textarea"])},null,8,["modelValue","placeholder","class"])]),_:1})]),_:1},8,["model","rules"])]),footer:n(()=>[E("span",Ve,[l(p,{onClick:s.onCancel},{default:n(()=>[f(S(a.type==4?"\u5173\u95ED":"\u53D6\u6D88"),1)]),_:1},8,["onClick"]),a.type!=4?(i(),d(p,{key:0,type:"primary",onClick:s.onSubmit},{default:n(()=>[f(" \u786E\u8BA4 ")]),_:1},8,["onClick"])):$("",!0)])]),_:1},8,["modelValue","title","before-close"])}const xe=z(be,[["render",we],["__scopeId","data-v-57d3eeca"]]);const Ce={data(){return{thStyle:{color:"#9E9FA0",fontWeight:"100"},showSearch:!0,editorBox:{show:!1,type:1,ids:[]},uploadBox:{show:!1},tableData:[],pageIndex:1,pageSize:10,count:2,industrys:[]}},computed:{checkedAll:{get(){const e=this.tableData;return e.length===0?!1:e.every(t=>t.checked)},set(e){this.tableData.forEach(t=>t.checked=e)}},selectedRows(){return this.tableData.filter(e=>e.checked)},shouldDisabled(){return this.selectedRows.length===0}},methods:{...N(O,["resolveDictItemEnum"]),async init(){const e=await this.resolveDictItemEnum(["system_global_status"]),t=re(e.system_global_status),a=await de({...this.searchQuery,current:this.pageIndex,size:this.pageSize});this.pageIndex=a.current,this.pageSize=a.size,this.count=a.total,this.tableData=a.records.map(c=>{const{createTime:o,updateTime:s}=c;return o&&(c.createTime=q("YYYY-MM-DD",o)),s&&(c.updateTime=q("YYYY-MM-DD",s)),c.checked=!1,c.enabled=t[c.enabled],c})},async getIndustrys(){const e=await this.resolveDictItemEnum(["industrys"]);Object.assign(this,e)},industryFormat(e){let t="";return this.industrys.forEach(a=>{e.industry==a.v&&(t=a.k)}),t},async onRemoveRow({id:e}){F.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u6570\u636E\u5417 ?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>M({id:e})).then(()=>{B.success("\u5220\u9664\u6210\u529F"),this.init()}).catch(()=>null)},async onBatchRemoveRow(){F.confirm("\u60A8\u786E\u5B9A\u8981\u6279\u91CF\u5220\u9664\u9009\u4E2D\u7684\u6570\u636E\u5417 ?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>Promise.all(this.selectedRows.map(({id:e})=>M({id:e})))).then(()=>{B.success("\u6279\u91CF\u5220\u9664\u6210\u529F"),this.init()}).catch(()=>null)},onSearch(e){var t=e;e.year&&(t.year=P(e.year).format("YYYY")),e.month&&(t.month=P(e.month).format("YYYY-MM").split("-")[1]),this.searchQuery=t,this.init()},onEditorChange(e,t){[2,4].indexOf(e)>-1?t=[t]:e===3&&(t=this.selectedRows.map(a=>a.id)),this.editorBox.show=!0,this.editorBox.ids=t,this.editorBox.type=e},onUploadChange(){this.uploadBox.show=!0},upload(){},onPageChange(e,t){this.init()},indexAdd(e){return e+1+(this.pageIndex-1)*this.pageSize}},components:{Filters:ge,PostEditorDialog:xe},created(){this.getIndustrys(),this.init()}},Se=e=>(te("data-v-048478a5"),e=e(),oe(),e),Ie={class:"SystemPost"},De={class:"table-content"},Be={class:"sys-table-action"},Pe={class:"sys-table-main-actions"},Te={class:"sys-table-footer"},Ue=Se(()=>E("div",null,null,-1));function Ye(e,t,a,c,o,s){const x=w("Filters"),y=w("Plus"),h=G,_=A,v=w("Delete"),V=ue,p=ne,g=se,r=ae,U=le,Y=w("PostEditorDialog"),m=ee("auth");return i(),b("div",Ie,[l(x,{show:o.showSearch,onOnSearch:s.onSearch},null,8,["show","onOnSearch"]),E("div",De,[E("section",Be,[E("div",null,[k((i(),d(_,{type:"primary",onClick:t[0]||(t[0]=u=>s.onEditorChange(1))},{default:n(()=>[l(h,null,{default:n(()=>[l(y)]),_:1}),f(" \u65B0\u589E\u914D\u989D ")]),_:1})),[[m,"company:quota:add"]]),k((i(),d(_,{type:"danger",disabled:s.shouldDisabled,onClick:s.onBatchRemoveRow},{default:n(()=>[l(h,null,{default:n(()=>[l(v)]),_:1}),f(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled","onClick"])),[[m,"company:quota:delete"]])])]),k((i(),d(r,{data:o.tableData,stripe:"","header-cell-style":o.thStyle},{default:n(()=>[l(p,{width:"40"},{header:n(()=>[l(V,{modelValue:s.checkedAll,"onUpdate:modelValue":t[1]||(t[1]=u=>s.checkedAll=u)},null,8,["modelValue"])]),default:n(({row:u})=>[l(V,{modelValue:u.checked,"onUpdate:modelValue":C=>u.checked=C},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{width:"80",index:s.indexAdd,label:"\u5E8F\u53F7",align:"center",type:"index"},null,8,["index"]),l(p,{prop:"shortName",label:"\u4F01\u4E1A\u7B80\u79F0",align:"center"}),l(p,{prop:"industry",label:"\u6240\u5C5E\u884C\u4E1A",align:"center",formatter:s.industryFormat},null,8,["formatter"]),l(p,{prop:"type",label:"\u80FD\u8017\u9879\u76EE",align:"center"}),l(p,{prop:"year",label:"\u5E74\u5EA6",align:"center"}),l(p,{prop:"amount",label:"\u80FD\u8017\u914D\u989D",align:"center"}),l(p,{prop:"unit",label:"\u80FD\u8017\u5355\u4F4D",align:"center"}),l(p,{label:"\u64CD\u4F5C",align:"center",width:"200",fixed:"right"},{default:n(({row:u})=>[E("div",Pe,[k((i(),d(g,{type:"primary",underline:!1,onClick:C=>s.onEditorChange(4,u.id)},{default:n(()=>[f(" \u8BE6\u60C5 ")]),_:2},1032,["onClick"])),[[m,"company:quota:detail"]]),k((i(),d(g,{type:"primary",underline:!1,style:{margin:"0 0 0 14px"},onClick:C=>s.onEditorChange(2,u.id)},{default:n(()=>[f(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[m,"company:quota:update"]]),k((i(),d(g,{type:"danger",underline:!1,style:{margin:"0 0 0 14px"},onClick:C=>s.onRemoveRow(u)},{default:n(()=>[f(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[m,"company:quota:delete"]])])]),_:1})]),_:1},8,["data","header-cell-style"])),[[m,"company:quota:page"]]),E("div",Te,[Ue,l(U,{currentPage:o.pageIndex,"onUpdate:currentPage":t[2]||(t[2]=u=>o.pageIndex=u),"page-size":o.pageSize,"onUpdate:pageSize":t[3]||(t[3]=u=>o.pageSize=u),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:o.count,onSizeChange:t[4]||(t[4]=u=>s.onPageChange(o.pageIndex,u)),onCurrentChange:t[5]||(t[5]=u=>s.onPageChange(u,o.pageSize))},null,8,["currentPage","page-size","total"])])]),l(Y,{modelValue:o.editorBox.show,"onUpdate:modelValue":t[6]||(t[6]=u=>o.editorBox.show=u),type:o.editorBox.type,ids:o.editorBox.ids,onOnSubmit:s.init},null,8,["modelValue","type","ids","onOnSubmit"])])}const st=z(Ce,[["render",Ye],["__scopeId","data-v-048478a5"]]);export{st as default};

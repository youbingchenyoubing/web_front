import{bi as S,_ as P,r as _,o as d,a8 as h,w as s,aB as C,aC as oe,f as t,d as A,aA as z,F as L,h as c,E as K,b as O,c as I,bE as V,ab as F,e as g,bD as U,c8 as le,ac as se,p as ne,i as re}from"./index.41bf9c1b.js";import{E as ae}from"./el-pagination.1e9489f1.js";import{E as ie,a as me}from"./el-table-column.4b985531.js";import{E as ce,a as de}from"./el-select.1fc6c445.js";import{a as ue}from"./el-popper.7ae0c7d7.js";import{E as pe,a as _e,b as fe}from"./el-dropdown-item.20f44ebf.js";import{E as he}from"./el-link.e79f8a31.js";/* empty css                       *//* empty css                   */import{f as ge}from"./formatDate.66ef0a13.js";import{a as be,b as ye,c as ke,d as Ee,e as N}from"./index.ff9c5d6a.js";import"./el-collapse-transition.bb7c8a08.js";import{u as B,b as Ce}from"./EnumGlobalStore.f9b8c63d.js";import{E as we}from"./index.aa5a1392.js";import{E as M,a as j}from"./index.39967f43.js";import{E as ve}from"./el-dialog.db387371.js";import{E as Re}from"./el-tree.6cd31066.js";/* empty css                       */import{E as xe,a as Ve}from"./el-radio.4d7862e0.js";import{A as Se,n as Te}from"./index.6dbeb167.js";import{E as Y}from"./index.6f6ffc3e.js";import{u as De}from"./AuthGlobalStore.96259e5a.js";import{E as Pe}from"./index.01c8af0b.js";import"./isEqual.f69c734a.js";import"./debounce.917afbd5.js";import"./strings.2f51a18b.js";import"./castArray.422477ef.js";import"./refs.90407178.js";import"./index.5d666713.js";const Ae={props:["show"],emits:["search"],data(){return{form:{roleName:"",rolePerm:"",enabled:""},system_global_status:[]}},methods:{...S(B,["resolveDictItemEnum"]),async init(){const o=await this.resolveDictItemEnum(["system_global_status"]);Object.assign(this,o)},handleReset(){this.$refs.formRef.resetFields(),this.$emit("search",{})},handleSearch(){this.$emit("search",Object.entries(this.form).reduce((o,[e,n])=>(n!==""&&(o[e]=n),o),{}))}},created(){this.init()}};function Ie(o,e,n,m,l,r){const b=K,u=M,p=ce,y=de,k=_("Search"),w=O,E=I,v=_("Refresh"),R=j,a=we;return d(),h(a,null,{default:s(()=>[C(t(R,{class:"sys-filters",ref:"formRef",inline:"",model:l.form},{default:s(()=>[t(u,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:s(()=>[t(b,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:"",modelValue:l.form.roleName,"onUpdate:modelValue":e[0]||(e[0]=f=>l.form.roleName=f)},null,8,["modelValue"])]),_:1}),t(u,{label:"\u89D2\u8272\u7F16\u7801",prop:"rolePerm"},{default:s(()=>[t(b,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801",clearable:"",modelValue:l.form.rolePerm,"onUpdate:modelValue":e[1]||(e[1]=f=>l.form.rolePerm=f)},null,8,["modelValue"])]),_:1}),t(u,{label:"\u72B6\u6001",prop:"enabled"},{default:s(()=>[t(y,{placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",clearable:"",modelValue:l.form.enabled,"onUpdate:modelValue":e[2]||(e[2]=f=>l.form.enabled=f)},{default:s(()=>[(d(!0),A(L,null,z(l.system_global_status,f=>(d(),h(p,{key:f.v,label:f.k,value:f.v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(E,{type:"primary",onClick:r.handleSearch},{default:s(()=>[t(w,null,{default:s(()=>[t(k)]),_:1}),c(" \u641C\u7D22 ")]),_:1},8,["onClick"]),t(E,{onClick:r.handleReset},{default:s(()=>[t(w,null,{default:s(()=>[t(v)]),_:1}),c(" \u91CD\u7F6E ")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),[[oe,n.show]])]),_:1})}const Be=P(Ae,[["render",Ie]]);const Ue={props:["show","type","id"],emits:["update:show","onSubmit"],data(){return{permission:{openAll:!1,selectAll:!1,linkage:!1,treeList:[],treeProps:{label:"name"}},form:{roleName:"",rolePerm:"",enabled:1,descript:""},formRules:{roleName:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0",trigger:"blur"}],rolePerm:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u7F16\u7801",trigger:"blur"}]},system_global_status:[]}},computed:{_show:{get(){return this.show},set(o){this.$emit("update:show",o)}},title(){return this.type===1?"\u6DFB\u52A0\u89D2\u8272":"\u4FEE\u6539\u89D2\u8272"}},methods:{...S(B,["resolveDictItemEnum"]),init(){Se({current:1,size:1e3}).then(n=>{this.permission.treeList=Te(n.records)}),this.resolveDictItemEnum(["system_global_status"]).then(n=>{Object.assign(this,n),this.form.enabled=n.system_global_status[0].v});const{type:o,id:e}=this;o===2&&be({id:e}).then(async n=>{var l;Object.assign(this.form,{roleName:n.role.roleName,rolePerm:n.role.rolePerm,enabled:n.role.enabled.toString(),descript:(l=n.role.descript)!=null?l:""}),await this.$nextTick();const{menuTreeRef:m}=this.$refs;m.setCheckedKeys(n.permissions)})},async invokeCreate(){const{menuTreeRef:o}=this.$refs,{roleName:e,rolePerm:n,enabled:m,descript:l}=this.form,r={roleName:e,rolePerm:n,enabled:m,descript:l,permissionIds:[...o.getHalfCheckedKeys(),...o.getCheckedKeys()]};await ye(r),V.success("\u65B0\u589E\u7528\u6237\u6210\u529F")},async invokeUpdate(){const{menuTreeRef:o}=this.$refs,{roleName:e,rolePerm:n,enabled:m,descript:l}=this.form,{id:r}=this;await ke({id:r,roleName:e,rolePerm:n,enabled:m,descript:l,permissionIds:[...o.getHalfCheckedKeys(),...o.getCheckedKeys()]}),V.success("\u4FEE\u6539\u7528\u6237\u6210\u529F")},async onSubmit(){try{const{formRef:o,menuTreeRef:e}=this.$refs;if(await o.validate(),e.getCheckedNodes().length===0)return V.error("\u6743\u9650\u5217\u8868\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u9879")}catch{return}this.type===1?await this.invokeCreate():await this.invokeUpdate(),this.$emit("onSubmit",null),this.onCancel()},onCancel(){this._show=!1,this.$refs.formRef.resetFields(),this.permission.openAll=!1,this.permission.selectAll=!1,this.permission.linkage=!0,this.toggleTreeChecked(!1),this.toggleTreeCollapse(!1)},toggleTreeChecked(o){const{menuTreeRef:e}=this.$refs;this.permission.linkage?this.permission.treeList.forEach(n=>{e.setChecked(n,o,!0)}):e.setCheckedKeys(o?this.resolveTreeListKeys():[])},resolveTreeListKeys(o){return o=o!=null?o:this.permission.treeList,o.map(e=>[e.id,...e.children?this.resolveTreeListKeys(e.children):[]]).flat()},toggleTreeCollapse(o){const e=this.$refs.menuTreeRef.store.nodesMap;Object.keys(e).forEach(n=>e[n].expanded=o)}},watch:{show:{immediate:!0,handler(o){o&&this.init()}}}},Ne={class:"item-menu"},ze={class:"dialog-footer"};function Le(o,e,n,m,l,r){const b=K,u=M,p=xe,y=Ve,k=Y,w=Re,E=j,v=I,R=ve;return d(),h(R,{modelValue:r._show,"onUpdate:modelValue":e[7]||(e[7]=a=>r._show=a),title:r.title,width:"600px","append-to-body":!0,"destroy-on-close":!0,"before-close":r.onCancel},{default:s(()=>[t(E,{ref:"formRef",model:l.form,rules:l.formRules,"label-width":"90px"},{default:s(()=>[t(u,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:s(()=>[t(b,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",modelValue:l.form.roleName,"onUpdate:modelValue":e[0]||(e[0]=a=>l.form.roleName=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"\u89D2\u8272\u7F16\u7801",prop:"rolePerm"},{default:s(()=>[t(b,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801",modelValue:l.form.rolePerm,"onUpdate:modelValue":e[1]||(e[1]=a=>l.form.rolePerm=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"\u72B6\u6001",prop:"enabled"},{default:s(()=>[t(y,{modelValue:l.form.enabled,"onUpdate:modelValue":e[2]||(e[2]=a=>l.form.enabled=a)},{default:s(()=>[(d(!0),A(L,null,z(l.system_global_status,a=>(d(),h(p,{key:a.v,label:a.v},{default:s(()=>[c(F(a.k),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"\u83DC\u5355\u6743\u9650"},{default:s(()=>[g("div",Ne,[t(k,{modelValue:l.permission.openAll,"onUpdate:modelValue":e[3]||(e[3]=a=>l.permission.openAll=a),onChange:r.toggleTreeCollapse},{default:s(()=>[c(" \u5C55\u5F00/\u6298\u53E0 ")]),_:1},8,["modelValue","onChange"]),t(k,{modelValue:l.permission.selectAll,"onUpdate:modelValue":e[4]||(e[4]=a=>l.permission.selectAll=a),onChange:r.toggleTreeChecked},{default:s(()=>[c(" \u5168\u9009/\u5168\u4E0D\u9009 ")]),_:1},8,["modelValue","onChange"]),t(k,{modelValue:l.permission.linkage,"onUpdate:modelValue":e[5]||(e[5]=a=>l.permission.linkage=a)},{default:s(()=>[c(" \u7236\u5B50(\u8054\u52A8/\u4E0D\u8054\u52A8) ")]),_:1},8,["modelValue"]),t(w,{ref:"menuTreeRef",data:l.permission.treeList,props:l.permission.treeProps,"check-strictly":!l.permission.linkage,"default-expand-all":l.permission.openAll,"show-checkbox":"","node-key":"id",class:"tree"},null,8,["data","props","check-strictly","default-expand-all"])])]),_:1}),t(u,{label:"\u5907\u6CE8",prop:"descript"},{default:s(()=>[t(b,{type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",modelValue:l.form.descript,"onUpdate:modelValue":e[6]||(e[6]=a=>l.form.descript=a),maxlength:200,"show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),footer:s(()=>[g("span",ze,[t(v,{onClick:r.onCancel},{default:s(()=>[c("\u53D6\u6D88")]),_:1},8,["onClick"]),t(v,{type:"primary",onClick:r.onSubmit},{default:s(()=>[c(" \u786E\u8BA4 ")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title","before-close"])}const Ke=P(Ue,[["render",Le],["__scopeId","data-v-58b30fce"]]);const Oe={data(){return{showSearch:!0,editorBox:{show:!1,type:1,id:-10},updateRoleDialog:{show:!1,userIds:[]},tableData:[],pageIndex:1,pageSize:10,count:0}},computed:{checkedAll:{get(){const o=this.tableData;return o.length===0?!1:o.every(e=>e.checked)},set(o){this.tableData.forEach(e=>e.checked=o)}},selectedRows(){return this.tableData.filter(o=>o.checked)},disabledBatchAction(){return this.tableData.length===0?!0:this.selectedRows.length===0}},methods:{...S(De,["vIf_auth"]),...S(B,["resolveDictItemEnum"]),async init(){const o=await this.resolveDictItemEnum(["system_global_status"]),e=Ce(o.system_global_status),n=await Ee({current:Number(this.pageIndex),size:Number(this.pageSize),...this.searchQuery});n.records.forEach(m=>{m.checked=!1,m.enabled=e[m.enabled],m.createTime=ge("YYYY-MM-DD",m.createTime)}),Object.assign(this,{tableData:n.records,pageIndex:n.current,pageSize:n.size,count:n.total})},onRemoveRole({id:o}){U.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u89D2\u8272\u5417 ?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>N({id:o})).then(()=>{V.success("\u5220\u9664\u6210\u529F"),this.init()}).catch(()=>null)},onBatchRemoveRole(){U.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684\u89D2\u8272\u5417 ?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>Promise.all(selectedRows.map(({id:o})=>N({id:o})))).then(()=>{V.success("\u6279\u91CF\u5220\u9664\u6210\u529F"),this.init()}).catch(()=>null)},onSearch(o){this.searchQuery=o,this.init()},onPageChange(o,e){this.init()},onEditorBoxChange(o,e){Object.assign(this.editorBox,{show:!0,type:o,id:e==null?void 0:e.id})}},components:{Filters:Be,RoleEditorDialog:Ke},created(){this.searchQuery={},this.init()}},G=o=>(ne("data-v-9c1df95a"),o=o(),re(),o),Fe={class:"sys-table-action"},Me={class:"sys-table-main-actions"},je=G(()=>g("span",null,"\u5206\u914D\u7528\u6237",-1)),Ye={class:"sys-table-footer"},Ge=G(()=>g("div",null,null,-1));function Qe(o,e,n,m,l,r){const b=_("Filters"),u=_("Plus"),p=O,y=I,k=_("Delete"),w=_("Search"),E=ue,v=_("RefreshRight"),R=Y,a=ie,f=Pe,Q=_("EditPen"),T=he,H=_("DArrowRight"),q=_("User"),J=_("router-link"),W=pe,X=_e,Z=fe,$=me,ee=ae,te=_("RoleEditorDialog"),x=le("auth");return d(),A("div",null,[t(b,{show:l.showSearch,onSearch:r.onSearch},null,8,["show","onSearch"]),g("section",Fe,[g("div",null,[C((d(),h(y,{type:"primary",onClick:e[0]||(e[0]=i=>r.onEditorBoxChange(1))},{default:s(()=>[t(p,null,{default:s(()=>[t(u)]),_:1}),c(" \u65B0\u589E ")]),_:1})),[[x,"system:role:add"]]),C((d(),h(y,{type:"danger",disabled:r.disabledBatchAction,onClick:r.onBatchRemoveRole},{default:s(()=>[t(p,null,{default:s(()=>[t(k)]),_:1}),c(" \u5220\u9664 ")]),_:1},8,["disabled","onClick"])),[[x,"system:role:delete"]])]),g("div",null,[t(E,{class:"box-item",effect:"dark",content:`${l.showSearch?"\u9690\u85CF":"\u663E\u793A"}\u641C\u7D22`,placement:"top"},{default:s(()=>[t(y,{circle:"",plain:"",onClick:e[1]||(e[1]=i=>l.showSearch=!l.showSearch)},{default:s(()=>[t(p,null,{default:s(()=>[t(w)]),_:1})]),_:1})]),_:1},8,["content"]),t(E,{class:"box-item",effect:"dark",content:"\u5237\u65B0\u8868\u683C",placement:"top"},{default:s(()=>[t(y,{circle:"",plain:"",onClick:r.init},{default:s(()=>[t(p,null,{default:s(()=>[t(v)]),_:1})]),_:1},8,["onClick"])]),_:1})])]),C((d(),h($,{data:l.tableData,class:"table",stripe:"",border:""},{default:s(()=>[t(a,{width:"40"},{header:s(()=>[t(R,{modelValue:r.checkedAll,"onUpdate:modelValue":e[2]||(e[2]=i=>r.checkedAll=i)},null,8,["modelValue"])]),default:s(({row:i})=>[t(R,{modelValue:i.checked,"onUpdate:modelValue":D=>i.checked=D},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(a,{prop:"roleName",label:"\u89D2\u8272\u540D\u79F0",align:"center"}),t(a,{prop:"rolePerm",label:"\u89D2\u8272\u7F16\u7801",align:"center"}),t(a,{label:"\u662F\u5426\u542F\u7528",align:"center"},{default:s(({row:i})=>[t(f,null,{default:s(()=>[c(F(i.enabled),1)]),_:2},1024)]),_:1}),t(a,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",align:"center"}),t(a,{label:"\u64CD\u4F5C",align:"center"},{default:s(({row:i})=>[g("div",Me,[C((d(),h(T,{type:"primary",underline:!1,onClick:D=>r.onEditorBoxChange(2,i)},{default:s(()=>[t(p,null,{default:s(()=>[t(Q)]),_:1}),c(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[x,"system:role:update"]]),C((d(),h(T,{type:"danger",underline:!1,style:{margin:"0 8px"},onClick:D=>r.onRemoveRole(i)},{default:s(()=>[t(p,null,{default:s(()=>[t(k)]),_:1}),c(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[x,"system:role:delete"]]),t(Z,null,{dropdown:s(()=>[t(X,null,{default:s(()=>[o.vIf_auth("system:role:assigned")?(d(),h(W,{key:0},{default:s(()=>[t(J,{to:`/system/role-assigned?roleId=${i.id}`,class:"action-drop-item"},{default:s(()=>[t(p,null,{default:s(()=>[t(q)]),_:1}),je]),_:2},1032,["to"])]),_:2},1024)):se("",!0)]),_:2},1024)]),default:s(()=>[t(T,{type:"primary",underline:!1},{default:s(()=>[c(" \u66F4\u591A "),t(p,null,{default:s(()=>[t(H)]),_:1})]),_:1})]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[x,"system:role:page"]]),g("div",Ye,[Ge,g("div",null,[C(t(ee,{currentPage:l.pageIndex,"onUpdate:currentPage":e[3]||(e[3]=i=>l.pageIndex=i),"page-size":l.pageSize,"onUpdate:pageSize":e[4]||(e[4]=i=>l.pageSize=i),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:l.count,onSizeChange:e[5]||(e[5]=i=>r.onPageChange(l.pageIndex,i)),onCurrentChange:e[6]||(e[6]=i=>r.onPageChange(i,l.pageSize))},null,8,["currentPage","page-size","total"]),[[x,"system:role:page"]])])]),t(te,{show:l.editorBox.show,"onUpdate:show":e[7]||(e[7]=i=>l.editorBox.show=i),id:l.editorBox.id,type:l.editorBox.type,onOnSubmit:r.init},null,8,["show","id","type","onOnSubmit"])])}const Ct=P(Oe,[["render",Qe],["__scopeId","data-v-9c1df95a"]]);export{Ct as default};

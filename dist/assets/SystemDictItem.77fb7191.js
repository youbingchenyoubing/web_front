import{_ as x,r as h,o as m,a8 as g,w as n,aB as T,aC as Y,f as t,d as P,aA as Q,F as j,h as b,E as z,b as A,c as D,bE as V,e as v,bD as B,c8 as L}from"./index.41bf9c1b.js";import{E as G}from"./el-pagination.1e9489f1.js";import{E as H,a as J}from"./el-table-column.4b985531.js";import{E as K,a as W}from"./el-select.1fc6c445.js";import{a as X}from"./el-popper.7ae0c7d7.js";import{E as Z}from"./el-link.e79f8a31.js";/* empty css                       *//* empty css                   */import{f as $}from"./formatDate.66ef0a13.js";import"./el-collapse-transition.bb7c8a08.js";import{c as ee}from"./index.0ddc6997.js";import{E as te}from"./index.aa5a1392.js";import{E as O,a as F}from"./index.39967f43.js";import{E as oe}from"./el-dialog.db387371.js";import{E as le}from"./el-input-number.4430b736.js";import{a as ne,b as ie,c as re,d as se,e as U}from"./index.5d666713.js";import{E as ae}from"./index.6f6ffc3e.js";import"./isEqual.f69c734a.js";import"./debounce.917afbd5.js";import"./index.01c8af0b.js";import"./strings.2f51a18b.js";import"./castArray.422477ef.js";import"./refs.90407178.js";import"./index.56404ca9.js";const ce={props:["show","dictTypeInfo"],emits:["onSearch","update:dictTypeInfo"],data(){return{form:{dictType:"",key:"",value:""},dictTypeOptions:[]}},methods:{async init(){const{type:o}=this.$route.query,e=await ee({current:1,size:100});this.dictTypeOptions=e.records,this.form.dictType=o,this.$emit("update:dictTypeInfo",e.records.find(c=>c.type===o))},handleReset(){this.$emit("onSearch",{}),this.$refs.formRef.resetFields()},handleSearch(){const{dictType:o,key:e,value:c}=this.form;this.$emit("onSearch",{dictType:o,key:e,value:c}),this.$emit("update:dictTypeInfo",this.dictTypeOptions.find(_=>_.type===o))}},created(){this.init()}};function de(o,e,c,_,l,i){const y=K,p=W,a=O,u=z,k=h("Search"),w=A,s=D,I=h("Refresh"),C=F,f=te;return m(),g(f,null,{default:n(()=>[T(t(C,{class:"sys-filters",ref:"formRef",inline:"",model:l.form},{default:n(()=>[t(a,{label:"\u5B57\u5178\u540D\u79F0",prop:"dictType"},{default:n(()=>[t(p,{modelValue:l.form.dictType,"onUpdate:modelValue":e[0]||(e[0]=d=>l.form.dictType=d),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5B57\u5178\u540D\u79F0"},{default:n(()=>[(m(!0),P(j,null,Q(l.dictTypeOptions,d=>(m(),g(y,{key:d.id,label:d.name,value:d.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(a,{label:"\u5B57\u5178\u952E",prop:"key"},{default:n(()=>[t(u,{placeholder:"\u8BF7\u8F93\u5165\u5B57\u5178\u952E",clearable:"",modelValue:l.form.key,"onUpdate:modelValue":e[1]||(e[1]=d=>l.form.key=d)},null,8,["modelValue"])]),_:1}),t(a,{label:"\u5B57\u5178\u503C",prop:"value"},{default:n(()=>[t(u,{placeholder:"\u8BF7\u8F93\u5165\u5B57\u5178\u503C",clearable:"",modelValue:l.form.value,"onUpdate:modelValue":e[2]||(e[2]=d=>l.form.value=d)},null,8,["modelValue"])]),_:1}),t(a,null,{default:n(()=>[t(s,{type:"primary",onClick:i.handleSearch},{default:n(()=>[t(w,null,{default:n(()=>[t(k)]),_:1}),b(" \u641C\u7D22 ")]),_:1},8,["onClick"]),t(s,{onClick:i.handleReset},{default:n(()=>[t(w,null,{default:n(()=>[t(I)]),_:1}),b(" \u91CD\u7F6E ")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),[[Y,c.show]])]),_:1})}const me=x(ce,[["render",de]]),pe={props:["modelValue","type","ids","dictTypeInfo"],emits:["update:modelValue","onSubmit"],data(){return{form:{k:"",v:"",sort:1,remark:""},rules:{k:[{required:!0,message:"\u5B57\u5178\u952E\u540D\u4E3A\u5FC5\u586B\u9879",trigger:"blur"},{min:1,message:"\u5B57\u5178\u952E\u540D\u4E3A\u5FC5\u586B\u9879",trigger:"blur"}],v:[{required:!0,message:"\u5B57\u5178\u952E\u540D\u4E3A\u5FC5\u586B\u9879",trigger:"blur"},{min:1,message:"\u5B57\u5178\u952E\u540D\u4E3A\u5FC5\u586B\u9879",trigger:"blur"}],sort:[{required:!0,message:"",trigger:"blur"}]}}},computed:{show:{get(){return this.modelValue},set(o){this.$emit("update:modelValue",o)}},title(){return this.type===1?"\u6DFB\u52A0\u5B57\u5178\u9879":"\u4FEE\u6539\u5B57\u5178\u7C7B\u9879"},dictType(){const o=this.dictTypeInfo;return`${o.name}\uFF08${o.type}\uFF09`}},methods:{async init(){if(this.type===2){const o=await ne({id:this.ids[0]});Object.assign(this.form,o)}},async invokeCreate(){const{k:o,v:e,sort:c,remark:_}=this.form;await ie({k:o,v:e,sort:c,remark:_,typeId:this.dictTypeInfo.id}),V.success("\u6DFB\u52A0\u5B57\u5178\u9879\u6210\u529F")},async invokeUpdate(o){const{k:e,v:c,sort:_,remark:l}=this.form;await re({id:o,k:e,v:c,sort:_,remark:l,typeId:this.dictTypeInfo.id}),V.success("\u4FEE\u6539\u5B57\u5178\u9879\u6210\u529F")},async onSubmit(){try{const{formRef:e}=this.$refs;await e.validate()}catch{return}const{type:o}=this;if(o===1)await this.invokeCreate();else if(o===2)await this.invokeUpdate(this.ids[0]);else if(o===3)await Promise.all(this.ids.map(this.invokeUpdate));else return console.error("SystemDict->EditorDialog->onSubmit: \u672A\u77E5\u7684\u64CD\u4F5C\u7C7B\u578B "+o);this.onCancel(),this.$emit("onSubmit")},onCancel(){const{formRef:o}=this.$refs;this.show=!1,o.resetFields()}},watch:{show:{immediate:!0,handler(o){o&&this.init()}}}},ue={class:"dialog-footer"};function fe(o,e,c,_,l,i){const y=z,p=O,a=le,u=F,k=D,w=oe;return m(),g(w,{modelValue:i.show,"onUpdate:modelValue":e[4]||(e[4]=s=>i.show=s),title:i.title,width:"600px","append-to-body":!0,"destroy-on-close":!0,"before-close":i.onCancel},{default:n(()=>[t(u,{ref:"formRef",model:l.form,rules:l.rules,"label-width":"90px",class:"form"},{default:n(()=>[t(p,{label:"\u5B57\u5178\u7C7B\u578B"},{default:n(()=>[t(y,{value:i.dictType,disabled:""},null,8,["value"])]),_:1}),t(p,{label:"\u5B57\u5178\u952E",prop:"k"},{default:n(()=>[t(y,{modelValue:l.form.k,"onUpdate:modelValue":e[0]||(e[0]=s=>l.form.k=s),placeholder:"\u8BF7\u8F93\u5165\u5B57\u5178\u952E"},null,8,["modelValue"])]),_:1}),t(p,{label:"\u5B57\u5178\u503C",prop:"v"},{default:n(()=>[t(y,{modelValue:l.form.v,"onUpdate:modelValue":e[1]||(e[1]=s=>l.form.v=s),placeholder:"\u8BF7\u8F93\u5165\u5B57\u5178\u503C"},null,8,["modelValue"])]),_:1}),t(p,{label:"\u6392\u5E8F",prop:"sort"},{default:n(()=>[t(a,{modelValue:l.form.sort,"onUpdate:modelValue":e[2]||(e[2]=s=>l.form.sort=s),min:1},null,8,["modelValue"])]),_:1}),t(p,{label:"\u63CF\u8FF0",prop:"remark"},{default:n(()=>[t(y,{modelValue:l.form.remark,"onUpdate:modelValue":e[3]||(e[3]=s=>l.form.remark=s),placeholder:"\u8BF7\u8F93\u5165\u5B57\u5178\u63CF\u8FF0",type:"textarea",maxlength:200,"show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),footer:n(()=>[v("span",ue,[t(k,{onClick:i.onCancel},{default:n(()=>[b("\u53D6\u6D88")]),_:1},8,["onClick"]),t(k,{type:"primary",onClick:i.onSubmit},{default:n(()=>[b(" \u786E\u8BA4 ")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title","before-close"])}const he=x(pe,[["render",fe]]),_e={data(){return{showSearch:!0,dictTypeInfo:{},editorBox:{show:!1,ids:[],type:1},tableData:[],pageIndex:1,pageSize:10,count:2}},computed:{checkedAll:{get(){return this.tableData.length===0?!1:this.tableData.every(e=>e.checked)},set(o){this.tableData.forEach(e=>e.checked=o)}},selectedRows(){return this.tableData.filter(o=>o.checked)},shouldDisableBatch(){return this.selectedRows.length===0}},methods:{async init(){const o=await se({current:this.pageIndex,size:this.pageSize,...this.searchQuery});o.records.forEach(e=>{e.checked=!1,e.createTime=$("YYYY-MM-DD",e.createTime)}),this.count=o.total,this.tableData=o.records},async onRemoveRow({id:o}){B.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u5B57\u5178\u9879\u5417 ?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>U({id:o})).then(()=>{V.success("\u5220\u9664\u6210\u529F"),this.init()}).catch(()=>null)},async onBatchRemoveRow(){B.confirm("\u60A8\u786E\u5B9A\u8981\u6279\u91CF\u5220\u9664\u9009\u4E2D\u7684\u5B57\u5178\u9879\u5417 ?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>Promise.all(this.selectedRows(({id:o})=>U({id:o})))).then(()=>{V.success("\u6279\u91CF\u5220\u9664\u6210\u529F"),this.init()}).catch(()=>null)},onEditorChange(o,e=[]){o===2&&(e=[e]),this.editorBox.show=!0,this.editorBox.ids=e,this.editorBox.type=o},onPageChange(o,e){this.init()},onSearch(o){this.searchQuery=o,this.init()}},components:{Filters:me,DictItemEditorDialog:he},created(){const{type:o}=this.$route.query;if(!o){V.error("\u975E\u6CD5\u8FDB\u5165\u9875\u9762"),this.$router.go(-1);return}this.searchQuery={dictType:o},this.init()}},ye={class:"SystemDictItem"},ge={class:"sys-table-action"},be={class:"sys-table-main-actions"},ke={class:"sys-table-footer"},ve=v("div",null,null,-1);function we(o,e,c,_,l,i){const y=h("Filters"),p=h("Plus"),a=A,u=D,k=h("Delete"),w=h("Search"),s=X,I=h("RefreshRight"),C=ae,f=H,d=h("EditPen"),R=Z,q=J,M=G,N=h("DictItemEditorDialog"),E=L("auth");return m(),P("div",ye,[t(y,{show:l.showSearch,dictTypeInfo:l.dictTypeInfo,"onUpdate:dictTypeInfo":e[0]||(e[0]=r=>l.dictTypeInfo=r),onOnSearch:i.onSearch},null,8,["show","dictTypeInfo","onOnSearch"]),v("section",ge,[v("div",null,[T((m(),g(u,{type:"primary",onClick:e[1]||(e[1]=r=>i.onEditorChange(1))},{default:n(()=>[t(a,null,{default:n(()=>[t(p)]),_:1}),b(" \u65B0\u589E ")]),_:1})),[[E,"system:dictitem:add"]]),T((m(),g(u,{type:"danger",disabled:i.shouldDisableBatch,onClick:i.onBatchRemoveRow},{default:n(()=>[t(a,null,{default:n(()=>[t(k)]),_:1}),b(" \u5220\u9664 ")]),_:1},8,["disabled","onClick"])),[[E,"system:dictitem:delete"]])]),v("div",null,[t(s,{class:"box-item",effect:"dark",content:`${l.showSearch?"\u9690\u85CF":"\u663E\u793A"}\u641C\u7D22`,placement:"top"},{default:n(()=>[t(u,{circle:"",plain:"",onClick:e[2]||(e[2]=r=>l.showSearch=!l.showSearch)},{default:n(()=>[t(a,null,{default:n(()=>[t(w)]),_:1})]),_:1})]),_:1},8,["content"]),t(s,{class:"box-item",effect:"dark",content:"\u5237\u65B0\u8868\u683C",placement:"top"},{default:n(()=>[t(u,{circle:"",plain:"",onClick:i.init},{default:n(()=>[t(a,null,{default:n(()=>[t(I)]),_:1})]),_:1},8,["onClick"])]),_:1})])]),T((m(),g(q,{data:l.tableData,stripe:"",border:""},{default:n(()=>[t(f,{width:"40"},{header:n(()=>[t(C,{modelValue:i.checkedAll,"onUpdate:modelValue":e[3]||(e[3]=r=>i.checkedAll=r)},null,8,["modelValue"])]),default:n(({row:r})=>[t(C,{modelValue:r.checked,"onUpdate:modelValue":S=>r.checked=S},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(f,{prop:"k",label:"\u5B57\u5178\u952E\u540D",align:"center"}),t(f,{prop:"v",label:"\u5B57\u5178\u952E\u503C",align:"center"}),t(f,{prop:"sort",label:"\u6392\u5E8F",align:"center"}),t(f,{prop:"remark",label:"\u5B57\u5178\u63CF\u8FF0",align:"center"}),t(f,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",align:"center"}),t(f,{label:"\u64CD\u4F5C",align:"center"},{default:n(({row:r})=>[v("div",be,[T((m(),g(R,{type:"primary",underline:!1,onClick:S=>i.onEditorChange(2,r.id)},{default:n(()=>[t(a,null,{default:n(()=>[t(d)]),_:1}),b(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[E,"system:dictitem:update"]]),T((m(),g(R,{type:"danger",underline:!1,style:{margin:"0 0 0 4px"},onClick:S=>i.onRemoveRow(r)},{default:n(()=>[t(a,null,{default:n(()=>[t(k)]),_:1}),b(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[E,"system:dictitem:delete"]])])]),_:1})]),_:1},8,["data"])),[[E,"system:dictitem:page"]]),v("div",ke,[ve,t(M,{currentPage:l.pageIndex,"onUpdate:currentPage":e[4]||(e[4]=r=>l.pageIndex=r),"page-size":l.pageSize,"onUpdate:pageSize":e[5]||(e[5]=r=>l.pageSize=r),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:l.count,onSizeChange:e[6]||(e[6]=r=>i.onPageChange(l.pageIndex,r)),onCurrentChange:e[7]||(e[7]=r=>i.onPageChange(r,l.pageSize))},null,8,["currentPage","page-size","total"])]),t(N,{modelValue:l.editorBox.show,"onUpdate:modelValue":e[8]||(e[8]=r=>l.editorBox.show=r),type:l.editorBox.type,ids:l.editorBox.ids,dictTypeInfo:l.dictTypeInfo,onOnSubmit:i.init},null,8,["modelValue","type","ids","dictTypeInfo","onOnSubmit"])])}const He=x(_e,[["render",we]]);export{He as default};

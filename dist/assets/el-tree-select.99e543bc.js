import{a as T,E as I,s as B}from"./el-select.1fc6c445.js";import{_ as p}from"./el-tree.6cd31066.js";import{L as F,M as j,a4 as V,b0 as A,Q as q,aQ as E,I as k,J as H,aU as Q,X as z,Y as J,H as R,P as S,a0 as W,bp as M,W as X}from"./index.41bf9c1b.js";import{e as Y}from"./strings.2f51a18b.js";import{q as $}from"./isEqual.f69c734a.js";const D=(e,{attrs:a,emit:d},{select:i,tree:s,key:n})=>{const u=F("tree-select");return j(()=>e.data,()=>{e.filterable&&V(()=>{var t,h;(h=s.value)==null||h.filter((t=i.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...A(q(e),Object.keys(T.props)),...a,"onUpdate:modelValue":t=>d(E,t),valueKey:n,popperClass:k(()=>{const t=[u.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=s.value)==null||h.filter(t)}}},G=H({extends:I,setup(e,a){const d=I.setup(e,a);delete d.selectOptionClick;const i=Q().proxy;return V(()=>{d.select.states.cachedOptions.get(i.value)||d.select.onOptionCreate(i)}),d},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function L(e){return e||e===0}function w(e){return Array.isArray(e)&&e.length}function g(e){return Array.isArray(e)?e:L(e)?[e]:[]}function _(e,a,d,i,s){for(let n=0;n<e.length;n++){const u=e[n];if(a(u,n,e,s))return i?i(u,n,e,s):u;{const C=d(u);if(w(C)){const t=_(C,a,d,i,u);if(t)return t}}}}function P(e,a,d,i){for(let s=0;s<e.length;s++){const n=e[s];a(n,s,e,i);const u=d(n);w(u)&&P(u,a,d,n)}}const Z=(e,{attrs:a,slots:d,emit:i},{select:s,tree:n,key:u})=>{j(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const l=n.value;l&&!$(l.getCheckedKeys(),g(e.modelValue))&&l.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var o;const r=C.value[l];return z(r)?r(c,(o=n.value)==null?void 0:o.getNode(t("value",c))):c[r]},h=g(e.modelValue).map(l=>_(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,o,r,v)=>v&&t("value",v))).filter(l=>L(l)),b=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return P(e.data.concat(e.cacheData),c=>{const o=t("value",c);l.push({value:o,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l});return{...A(q(e),Object.keys(p.props)),...a,nodeKey:u,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:c,data:o,store:r})=>l(G,{value:t("value",o),label:t("label",o),disabled:t("disabled",o)},e.renderContent?()=>e.renderContent(l,{node:c,data:o,store:r}):d.default?()=>d.default({node:c,data:o,store:r}):void 0),filterNodeMethod:(l,c,o)=>e.filterNodeMethod?e.filterNodeMethod(l,c,o):l?new RegExp(Y(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,o)=>{var r,v,m,K;if((r=a.onNodeClick)==null||r.call(a,l,c,o),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const N=(v=s.value)==null?void 0:v.states.options.get(t("value",l));(m=s.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&o.proxy.handleExpandIconClick();(K=s.value)==null||K.focus()}},onCheck:(l,c)=>{var o;if(!e.showCheckbox)return;const r=t("value",l),v={};P([n.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=c.checkedKeys,K=e.multiple?g(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],N=K.concat(m);if(e.checkStrictly)i(E,e.multiple?N:N.includes(r)?r:void 0);else if(e.multiple)i(E,K.concat(n.value.getCheckedKeys(!0)));else{const f=_([l],y=>!w(t("children",y))&&!t("disabled",y),y=>t("children",y)),x=f?t("value",f):void 0,U=L(e.modelValue)&&!!_([l],y=>t("value",y)===e.modelValue,y=>t("children",y));i(E,x===e.modelValue||U?void 0:x)}V(()=>{var f;const x=g(e.modelValue);n.value.setCheckedKeys(x),(f=a.onCheck)==null||f.call(a,l,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})}),(o=s.value)==null||o.focus()},cacheOptions:b}};var ee=H({props:{data:{type:Array,default:()=>[]}},setup(e){const a=J(B);return j(()=>e.data,()=>{var d;e.data.forEach(s=>{a.states.cachedOptions.has(s.value)||a.states.cachedOptions.set(s.value,s)});const i=((d=a.selectRef)==null?void 0:d.querySelectorAll("input"))||[];Array.from(i).includes(document.activeElement)||a.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const te=H({name:"ElTreeSelect",inheritAttrs:!1,props:{...T.props,...p.props,cacheData:{type:Array,default:()=>[]}},setup(e,a){const{slots:d,expose:i}=a,s=R(),n=R(),u=k(()=>e.nodeKey||e.valueKey||"value"),C=D(e,a,{select:s,tree:n,key:u}),{cacheOptions:t,...h}=Z(e,a,{select:s,tree:n,key:u}),b=S({});return i(b),W(()=>{Object.assign(b,{...A(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...A(s.value,["focus","blur"])})}),()=>M(T,S({...C,ref:l=>s.value=l}),{...d,default:()=>[M(ee,{data:t.value}),M(p,S({...h,ref:l=>n.value=l}))]})}});var O=X(te,[["__file","tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const le=O,oe=le;export{oe as E};
